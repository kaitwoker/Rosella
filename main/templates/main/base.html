{% load static %}

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}RoselleAI{% endblock %}</title>
    
    <!-- –°—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    
    {% block extra_css %}{% endblock extra_css %}
</head>
<body>

<!-- –ù–∞–≤–±–∞—Ä -->
<nav class="navbar navbar-expand-lg roselle-navbar shadow-sm">
    <div class="container">
        <!-- –õ–æ–≥–æ—Ç–∏–ø -->
        <a class="navbar-brand roselle-navbar-brand" href="{% url 'main:index' %}">
            <img src="{% static 'img/logo1.png' %}" alt="RoselleAI" height="100">
        </a>

        <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –º–µ–Ω—é -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#roselleNavbarNav"
                aria-controls="roselleNavbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        
        <!-- –ú–µ–Ω—é -->
        <div class="collapse navbar-collapse" id="roselleNavbarNav">
            <ul class="navbar-nav ms-auto roselle-navbar-nav">
                <li class="nav-item">
                    <a class="nav-link roselle-nav-link" href="{% url 'main:product_list' %}">–ö–∞—Ç–∞–ª–æ–≥</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link roselle-nav-link position-relative" href="{% url 'cart:cart_detail' %}">
                        üõí –ö–æ—Ä–∑–∏–Ω–∞
                        {% if cart_item_count > 0 %}
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                            {{ cart_item_count }}
                            <span class="visually-hidden">—Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ</span>
                        </span>
                        {% endif %}
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link roselle-nav-link position-relative" href="{% url 'favorites:favorite_detail' %}">
                        ‚ù§Ô∏è –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
                        {% if favorite_item_count > 0 %}
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                            {{ favorite_item_count }}
                            <span class="visually-hidden">—Ç–æ–≤–∞—Ä–æ–≤ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–º</span>
                        </span>
                        {% endif %}
                    </a>
                </li>

                
                
                <!-- –†–∞–∑–¥–µ–ª–µ–Ω–Ω—ã–µ –ø—É–Ω–∫—Ç—ã –º–µ–Ω—é –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–æ–ª–µ–π -->
                {% if request.user.role == 'admin' or request.user.role == 'florist' %}
                    <li class="nav-item">
                        <a class="nav-link roselle-nav-link" href="{% url 'orders:collection' %}">–°–±–æ—Ä –∑–∞–∫–∞–∑–æ–≤</a>
                    </li>
                {% endif %}

                {% if request.user.role == 'admin' or request.user.role == 'courier' %}
                    <li class="nav-item">
                        <a class="nav-link roselle-nav-link" href="{% url 'orders:delivery' %}">–î–æ—Å—Ç–∞–≤–∫–∞ –∑–∞–∫–∞–∑–æ–≤</a>
                    </li>
                {% endif %}

                {% if user.is_authenticated %}
                    <li class="nav-item">
                        <a class="nav-link roselle-nav-link" href="{% url 'users:dashboard' %}">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link roselle-nav-link" href="{% url 'users:logout' %}">–í—ã–π—Ç–∏</a>
                    </li>
                {% else %}
                    <li class="nav-item">
                        <a class="nav-link roselle-nav-link" href="{% url 'users:login' %}">–í—Ö–æ–¥/–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                    </li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>

<!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
<div class="container mt-4 roselle-main-container">
    {% block content %}{% endblock %}
</div>

<!-- Footer -->
<footer class="bg-light border-top mt-5 py-4">
    <div class="container">
        <div class="row">

            <!-- –û –Ω–∞—Å -->
            <div class="col-md-4 mb-4">
                <h5 class="fw-bold">RoselleAI</h5>
                <p class="small text-muted">
                    –¶–≤–µ—Ç—ã, –ø–æ–¥–∞—Ä–∫–∏ –∏ —Ä–æ–º–∞–Ω—Ç–∏–∫–∞ ‚Äî –≤—Å—ë –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ. –î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –ê–ª–º–∞—Ç—ã –∏ –≤—Å–µ–º—É –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω—É. –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –æ—Ç–∫—Ä—ã—Ç–∫–∞, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Ö–æ–¥—É –∏ —É–¥–æ–±—Ä–µ–Ω–∏–µ ‚Äî –∫ –∫–∞–∂–¥–æ–º—É –∑–∞–∫–∞–∑—É.
                </p>
            </div>

            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
            <div class="col-md-3 mb-4">
                <h6 class="fw-bold">–ù–∞–≤–∏–≥–∞—Ü–∏—è</h6>
                <ul class="list-unstyled">
                    <li><a href="{% url 'main:index' %}" class="text-decoration-none text-muted">–ì–ª–∞–≤–Ω–∞—è</a></li>
                    <li><a href="{% url 'main:product_list' %}" class="text-decoration-none text-muted">–ö–∞—Ç–∞–ª–æ–≥</a></li>
                    <li><a href="{% url 'main:about' %}" class="text-decoration-none text-muted">–û –Ω–∞—Å</a></li>
                    <li><a href="{% url 'main:contact' %}" class="text-decoration-none text-muted">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
                    <li><a href="{% url 'constructor:bouquet_constructor' %}" class="text-decoration-none text-muted">–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –±—É–∫–µ—Ç–∞</a></li>
                </ul>
            </div>

            <!-- –ö–æ–Ω—Ç–∞–∫—Ç—ã -->
            <div class="col-md-5 mb-4">
                <h6 class="fw-bold">–ö–æ–Ω—Ç–∞–∫—Ç—ã</h6>
                <p class="mb-1 text-muted">–≥. –ê–ª–º–∞—Ç—ã, –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω</p>
                <p class="mb-1 text-muted">+7 (705) 667-30-07</p>
                <p class="mb-1 text-muted">biblik487@gmail.com</p>
                <p class="mb-2 text-muted">–†–∞–±–æ—Ç–∞–µ–º –µ–∂–µ–¥–Ω–µ–≤–Ω–æ —Å 07:00 –¥–æ 01:00</p>

                <!-- –°–æ—Ü—Å–µ—Ç–∏ -->
                <div>
                    <a href="#" class="me-3 text-muted fs-5"><i class="bi bi-instagram"></i></a>
                    <a href="#" class="me-3 text-muted fs-5"><i class="bi bi-telegram"></i></a>
                    <a href="#" class="me-3 text-muted fs-5"><i class="bi bi-whatsapp"></i></a>
                </div>
            </div>
        </div>

        <hr>

        <!-- –ü–æ–¥–ø–∏—Å—å -->
        <div class="text-center small text-muted">
            ¬© 2025 RoselleAI ‚Äî –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
        </div>
    </div>
</footer>

<!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —á–∞—Ç–∞ -->
<button type="button" class="btn btn-primary rounded-circle shadow"
        data-bs-toggle="modal" data-bs-target="#chatModal"
        style="position: fixed; bottom: 20px; right: 20px; z-index: 1000; width: 60px; height: 60px; display: flex; justify-content: center; align-items: center;">
    <i class="bi bi-chat-dots-fill" style="font-size: 28px; color: #fff;"></i>
</button>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —á–∞—Ç–∞ -->
<div class="modal fade" id="chatModal" tabindex="-1" aria-labelledby="chatModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="chatModalLabel">–ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
            </div>
            <div class="modal-body">
                <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π —á–∞—Ç–∞ -->
                <div id="chatMessages" style="max-height: 400px; overflow-y: auto; padding: 10px; background-color: #f8f9fa; border-radius: 4px;">
                    <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è: —Å–Ω–∞—á–∞–ª–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∑–∞—Ç–µ–º –æ—Ç–≤–µ—Ç –±–æ—Ç–∞ -->
                </div>
            </div>
            <div class="modal-footer">
                <input type="text" id="chatInput" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
                <button id="sendChat" type="button" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>
</div>




{% comment %} <!-- –ö–Ω–æ–ø–∫–∞ —á–∞—Ç-–±–æ—Ç–∞ -->
<button id="chatbotToggle" class="btn btn-danger rounded-circle shadow" 
        style="position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; z-index: 1000;">
    <i class="bi bi-chat-dots fs-4"></i>
</button>

<!-- –û–∫–Ω–æ —á–∞—Ç–∞ -->
<div id="chatbotWindow" style="display: none; position: fixed; bottom: 90px; right: 20px; width: 320px; height: 420px; background: #fff; border: 1px solid #ccc; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); z-index: 1000; overflow: hidden;">
    <div id="chat" style="height: 85%; overflow-y: auto; padding: 10px;"></div>
    <div style="display: flex; height: 15%; border-top: 1px solid #ccc;">
        <input id="chatInput" type="text" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." class="form-control border-0" style="border-radius: 0;">
        <button id="chatSend" class="btn btn-primary"><i class="bi bi-send"></i></button>
    </div>
</div> {% endcomment %}



<!-- –°–∫—Ä–∏–ø—Ç—ã -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
{% comment %} <script>
document.getElementById("chatbotToggle").addEventListener("click", () => {
    const windowEl = document.getElementById("chatbotWindow");
    windowEl.style.display = windowEl.style.display === "none" ? "block" : "none";
});

const chatDiv = document.getElementById("chat");
const input = document.getElementById("chatInput");
const sendBtn = document.getElementById("chatSend");

async function sendMessage() {
    const text = input.value.trim();
    if (!text) return;
    chatDiv.innerHTML += `<div class="text-end mb-2"><span class="badge bg-primary">${text}</span></div>`;
    input.value = "";
    chatDiv.scrollTop = chatDiv.scrollHeight;

    try {
        const res = await fetch("{% url 'chatbot:chat_api' %}", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": "{{ csrf_token }}"
            },
            body: JSON.stringify({ message: text })
        });
        const data = await res.json();
        chatDiv.innerHTML += `<div class="text-start mb-2"><span class="badge bg-light text-dark">${data.reply}</span></div>`;
        chatDiv.scrollTop = chatDiv.scrollHeight;
    } catch (err) {
        chatDiv.innerHTML += `<div class="text-start text-danger small">–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ —á–∞—Ç—É.</div>`;
    }
}

sendBtn.onclick = sendMessage;
input.addEventListener("keydown", (e) => {
    if (e.key === "Enter") sendMessage();
});
</script> {% endcomment %}
<script>
document.getElementById("sendChat").addEventListener("click", function() {
    const inputField = document.getElementById("chatInput");
    let message = inputField.value.trim();
    if (message === "") return;

    // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –æ–∫–Ω–æ —á–∞—Ç–∞
    let chatMessages = document.getElementById("chatMessages");
    let userMsgDiv = document.createElement("div");
    userMsgDiv.classList.add("text-end", "mb-2");
    userMsgDiv.textContent = "–í—ã: " + message;
    chatMessages.appendChild(userMsgDiv);

    // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
    inputField.value = "";

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º AJAX-–∑–∞–ø—Ä–æ—Å –Ω–∞ API —á–∞—Ç-–±–æ—Ç–∞
    fetch("{% url 'chatbot:chat_api' %}", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": "{{ csrf_token }}"
        },
        body: JSON.stringify({ message: message })
    })
    .then(response => response.json())
    .then(data => {
        let botMsgDiv = document.createElement("div");
        botMsgDiv.classList.add("text-start", "mb-2");
        botMsgDiv.textContent = "–î–∏–ª—å–Ω–∞–∑: " + data.reply;
        chatMessages.appendChild(botMsgDiv);
        // –°–∫—Ä–æ–ª–ª –≤–Ω–∏–∑, —á—Ç–æ–±—ã –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–∏–¥–Ω–æ –±—ã–ª–æ –≤—Å–µ–≥–¥–∞
        chatMessages.scrollTop = chatMessages.scrollHeight;
    })
    .catch(err => {
        let errorMsgDiv = document.createElement("div");
        errorMsgDiv.classList.add("text-start", "mb-2", "text-danger");
        errorMsgDiv.textContent = "–û—à–∏–±–∫–∞: " + err;
        chatMessages.appendChild(errorMsgDiv);
    });
});

// –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ –Ω–∞–∂–∞—Ç–∏—é Enter
document.getElementById("chatInput").addEventListener("keyup", function(event) {
    if (event.key === "Enter") {
        document.getElementById("sendChat").click();
    }
});
</script>

{% block extra_js %}{% endblock extra_js %}
</body>
</html>